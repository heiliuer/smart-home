C51 COMPILER V9.55   SMARTHOME                                                             04/17/2016 00:41:41 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE SMARTHOME
OBJECT MODULE PLACED IN .\Objects\smarthome.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE smarthome.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXT
                    -END PRINT(.\Listings\smarthome.lst) TABS(2) OBJECT(.\Objects\smarthome.obj)

line level    source

   1          #include<reg52.h>               
   2          
   3          
   4          
   5          void SendStr(unsigned char *s);
   6          
   7          unsigned int times=0;
   8          
   9          unsigned char send[5];
  10          
  11          /*------------------------------------------------
  12                              串口初始化
  13          ------------------------------------------------*/
  14          void InitUART  (void)
  15          {
  16   1          SCON  = 0x50;           // SCON: 模式 1, 8-bit UART, 使能接收  
  17   1          TMOD |= 0x20;               // TMOD: timer 1, mode 2, 8-bit 重装
  18   1          TH1   = 0xFD;               // TH1:  重装值 9600 波特率 晶振 11.0592MHz  
  19   1        TR1=1; //启动定时器                
  20   1          EA    = 1;                  //打开总中断
  21   1          ES    = 1;                  //打开串口中断
  22   1      }
  23          void SendByte(unsigned char dat);                            
  24          /*------------------------------------------------
  25                              主函数
  26          ------------------------------------------------*/
  27          void main (void)
  28          {
  29   1        int i=100,j;
  30   1        InitUART();
  31   1        //先输出0，再输出1，才能真正输出
  32   1          P0=0x00;
  33   1        P1=0x00;
  34   1        P2=0x00;
  35   1        P3=0x00;
  36   1      
  37   1        P0=0xff;
  38   1        P1=0xff;
  39   1        P2=0xff;
  40   1        P3=0xff;
  41   1        while (1){
  42   2          SendByte(0xff);
  43   2          while(i-->0){
  44   3            j=100;
  45   3            while(j-->0);
  46   3          }
  47   2        }
  48   1      }
  49          
  50          /*------------------------------------------------
  51                              发送一个字节
  52          ------------------------------------------------*/
  53          void SendByte(unsigned char dat)
  54          {
C51 COMPILER V9.55   SMARTHOME                                                             04/17/2016 00:41:41 PAGE 2   

  55   1         SBUF = dat;
  56   1         while(!TI);
  57   1         TI = 0;
  58   1      }
  59          /*------------------------------------------------
  60                              发送一个字符串
  61          ------------------------------------------------*/
  62          void SendStr(unsigned char *s)
  63          {
  64   1       while(*s!='\n')// \0 表示字符串结束标志，通过检测是否字符串末尾
  65   1        {
  66   2          SendByte(*s);
  67   2          s++;
  68   2        }
  69   1      }
  70          
  71          
  72          void receive_wait()
  73          {
  74   1          while(!RI);
  75   1          RI = 0;
  76   1      }
  77          
  78          void sendIOData(){
  79   1         send[0]=P0;
  80   1         send[1]=P1;
  81   1         send[2]=P2;
  82   1         send[3]=P3;
  83   1         send[4]='\n';
  84   1         SendStr(send);
  85   1      }
  86          
  87          /*------------------------------------------------
  88                              串口数据 控制组件
  89          ------------------------------------------------*/
  90          void UART_SER() interrupt 4 
  91          {
  92   1         if(RI)                        //判断是接收中断产生
  93   1           {
  94   2            RI=0;                      //标志位清零
  95   2            switch(SBUF){
  96   3              case 0xaa://读取所有IO口的电平状态
  97   3              receive_wait();
  98   3              sendIOData();
  99   3              break;
 100   3              case 0xa0://设置P0的8位电平
 101   3              receive_wait();
 102   3              P0=SBUF;
 103   3              sendIOData();
 104   3              break;
 105   3              case 0xa1://设置P1的8位电平
 106   3              receive_wait();
 107   3              P1=SBUF;
 108   3              sendIOData();
 109   3              break;
 110   3              case 0xa2://设置P2的8位电平
 111   3              receive_wait();
 112   3              P2=SBUF;
 113   3              sendIOData();
 114   3              break;
 115   3              case 0xa3://设置P3的8位电平
 116   3              receive_wait();
C51 COMPILER V9.55   SMARTHOME                                                             04/17/2016 00:41:41 PAGE 3   

 117   3              P3=P3&0x03|SBUF;
 118   3              sendIOData();
 119   3              break;
 120   3            }
 121   2         }
 122   1          if(TI)                        //如果是发送标志位，清零
 123   1        {
 124   2            TI=0;
 125   2        }
 126   1      } 
 127          
 128          
 129          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    267    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
